<section id="counselorPanel" class="panel" style="display:none;">
  <h2>Counselor Dashboard</h2>

  <div id="counselorLoginArea" class="card">
    <h3>Counselor Sign In</h3>
    <div class="row">
      <label>Password
        <input id="counselorPassInput" type="password" placeholder="Admin password"/>
      </label>
      <button id="counselorLoginBtn">Sign In</button>
    </div>
    <div id="counselorLoginMsg" class="msg"></div>
  </div>

  <div id="counselorDashboard" class="card" style="display:none;">
    <div class="row spaceBetween">
      <div class="infoBlock">
        Use filters to find students. Students who have saved a schedule are highlighted green, those with reviewed schedules are blue, others red.
      </div>
      <button id="logoutCounselorBtn" class="danger" style="display:none;">Sign Out</button>
    </div>

    <div class="grid2">
      <div class="subcard">
        <h3>Submission Locks</h3>
        <div id="gradeLockControls"></div>
        <div class="row">
          <button id="saveGradeLocksBtn">Save Locks</button>
          <div id="gradeLockMsg" class="msg"></div>
        </div>
      </div>

      <div class="subcard">
        <h3>Subject/Area Colors</h3>
        <table class="simpleTable">
          <thead><tr><th>Subject</th><th>Color</th></tr></thead>
          <tbody id="subjectColorTbody"></tbody>
        </table>
        <div class="row">
          <button id="saveSubjectColorsBtn">Save Colors</button>
          <div id="colorSaveMsg" class="msg"></div>
        </div>
      </div>
    </div>

    <div class="subcard">
      <h3>Help / Templates</h3>
      <div class="row wrap">
        <a class="buttonlike" href="/download_template/students" target="_blank">Download Students Template</a>
        <a class="buttonlike" href="/download_template/courses" target="_blank">Download Courses Template</a>
        <a class="buttonlike" href="/download_template/teachers" target="_blank">Download Teachers Template</a>
        <a class="buttonlike" href="/download_template/schedules" target="_blank">Download Schedules Template</a>
      </div>
    </div>

    <div class="subcard">
      <h3>Upload CSVs</h3>
      <div class="row wrap">
        <label>Students CSV <input id="studentsCsvInput" type="file" accept=".csv"/></label>
        <label>Courses CSV <input id="coursesCsvInput" type="file" accept=".csv"/></label>
        <label>Teachers CSV <input id="teachersCsvInput" type="file" accept=".csv"/></label>
        <button id="uploadCsvBtn">Upload</button>
      </div>
      <div id="uploadMsg" class="msg"></div>
    </div>

    <div class="subcard">
      <h3>Student List</h3>
      <div class="row wrap">
        <label>Name <input id="filterName" type="text" placeholder="Search name"/></label>
        <label>Grade
          <select id="filterGrade">
            <option value="">All</option>
            <option value="9">9</option>
            <option value="10">10</option>
            <option value="11">11</option>
            <option value="12">12</option>
          </select>
        </label>
        <label>Course <input id="filterCourse" type="text" placeholder="Search course"/></label>
        <button id="applyFiltersBtn">Apply</button>
        <button id="exportFilteredBtn">Export Filtered</button>
        <button id="exportAllSchedulesBtn">Export All Schedules</button>
      </div>

      <div class="row wrap" style="align-items:center;margin-top:8px;">
        <div id="studentCount" class="countBadge" style="margin-right:12px;"></div>

        <label style="margin-right:8px;">Show
          <select id="perPageSelect">
            <option value="10">10</option>
            <option value="25">25</option>
            <option value="50" selected>50</option>
            <option value="100">100</option>
            <option value="all">All</option>
          </select>
        </label>

        <div id="paginationControls" class="paginationControls" style="display:inline-flex;align-items:center;margin-left:12px;">
          <button id="pagePrevBtn" class="smallBtn" style="margin-right:6px;">Prev</button>
          <span id="pageInfo" class="dimtext">Page 1</span>
          <button id="pageNextBtn" class="smallBtn" style="margin-left:6px;">Next</button>
        </div>
      </div>

      <table class="simpleTable" style="margin-top:8px;">
        <thead>
          <tr>
            <th>Select</th>
            <th>Student</th>
            <th>Academic (preview)</th>
            <th>Elective #1</th>
            <th>Approvals</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="counselorStudentRows"></tbody>
      </table>

      <div class="row wrap" style="margin-top:8px;">
        <button id="printCardsSelectedBtn">Print Cards (Selected)</button>
        <button id="printCardsAllBtn">Print Cards (All in view)</button>
        <label>Roster by Course Code <input id="rosterCourseCode" type="text" placeholder="ex: BIO"/></label>
        <button id="rosterPrintBtn">Print Roster</button>
      </div>
    </div>
  </div>

  <!-- Modal overlay for editing a student's schedule -->
  <div id="editScheduleModal" class="modal" aria-hidden="true" style="display:none;">
    <div class="modalInner" role="dialog" aria-modal="true" aria-labelledby="editScheduleTitle">
      <button id="editModalCloseBtn" class="modalClose smallBtn" aria-label="Close">✕</button>
      <h3 id="editScheduleTitle">Review Student Schedule</h3>
      <div id="editScheduleInfo" class="infoBlock" style="margin-bottom:8px;"></div>
      
      <!-- Review status indicator -->
      <div id="reviewStatusIndicator" class="infoBlock" style="margin-bottom:12px; padding:8px; border-radius:8px;"></div>

      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <div style="flex:1 1 320px;">
          <h4>Selected Academic (up to <span id="cMaxAcademicSpan"></span>)</h4>
          <div id="cSelectedAcademicList" class="modalList"></div>
        </div>

        <div style="flex:1 1 320px;">
          <h4>Elective / CTE Priorities (up to <span id="cMaxElectiveSpan"></span>)</h4>
          <div id="cSelectedElectiveList" class="modalList"></div>
        </div>
      </div>

      <div style="margin-top:12px;">
        <h4>Special Instructions</h4>
        <textarea id="counselorNotesInput" rows="3" style="width:100%;"></textarea>
      </div>

      <div style="margin-top:12px;">
        <h4>Add Courses</h4>
        <div class="row wrap">
          <label>Subject <input id="cFilterSubject" type="text" placeholder="ex: Science"/></label>
          <label>Search <input id="cFilterNameSearch" type="text" placeholder="ex: BIO"/></label>
          <button id="cRunCourseSearchBtn">Search</button>
        </div>
        <div id="cAvailableCoursesGrid" class="availableCoursesGrid" style="margin-top:8px;"></div>
      </div>

      <div class="row wrap" style="margin-top:12px;">
        <button id="saveCounselorScheduleBtn">Save</button>
        <button id="signOffScheduleBtn" class="success">Sign Off</button>
        <button id="resetScheduleBtn" class="danger">Reset Schedule</button>
        <div id="editScheduleMsg" class="msg" style="margin-left:12px;"></div>
      </div>
      
      <!-- Navigation buttons -->
      <div class="row wrap" style="margin-top:12px; border-top:1px solid var(--line); padding-top:12px;">
        <button id="previousStudentBtn" class="smallBtn">← Previous Student</button>
        <button id="nextStudentBtn" class="smallBtn">Next Student →</button>
        <div id="navigationMsg" class="msg" style="margin-left:12px;"></div>
      </div>
    </div>
  </div>

  <style>
    /* Modal styles: adapt to dark/light using CSS variables where possible */
    .modal {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(2,6,23,0.65); /* semi-transparent overlay */
      z-index: 9999;
      padding: 20px;
    }
    .modal[aria-hidden="true"] { display: none; }
    .modalInner {
      width: 100%;
      max-width: 1000px;
      max-height: calc(100vh - 80px);
      overflow: auto;
      background: var(--modal-background, #0b1220);
      color: var(--modal-foreground, #e6eef8);
      border-radius: 10px;
      padding: 18px;
      box-shadow: 0 8px 30px rgba(2,6,23,0.7);
      border: 1px solid rgba(255,255,255,0.06);
      position: relative;
    }
    body[data-theme="light"] .modalInner { background: #fff; color: #111827; border: 1px solid rgba(0,0,0,0.08); }
    .modalInner .modalClose { position: absolute; right: 12px; top: 12px; background: transparent; color: inherit; border: none; font-size: 1rem; cursor: pointer; }
    .modalList { min-height: 80px; border: 1px solid rgba(255,255,255,0.04); padding: 8px; border-radius: 4px; background: rgba(255,255,255,0.02); }
    .modalList .selectedRow { display: flex; align-items: center; justify-content: space-between; padding: 6px 4px; border-bottom: 1px dashed rgba(255,255,255,0.02); }
    .modalInner::-webkit-scrollbar { width: 10px; height: 10px; }
    .modalInner::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.06); border-radius: 8px; }
  </style>
</section>